input {
    zeromq_hs {
       debug => true
       type => "metlog"
       mode => "server"
       format => "plain"
       address => "tcp://*:5180"
    }

    zeromq {
       type => "metlog"
       mode => "server"
       format => "json"
       address => "tcp://*:5190"
       queue_size => 5
    }
}

filter {
    tagger {
        # all the oldstyle log.severity_level(...) messages get tagged to go to
        # HDFS and plain text output
        type => "metlog"
        pattern => [ "type", "oldstyle" ]
        add_tag => [ "output_text" ]
    }

    tagger {
        # all counter messages are tagged to go to statsd
        # exceptions
        type => "metlog"
        pattern => [ "type", "counter" ]
        add_tag => ["output_statsd"]
    }

    tagger {
        # all timer messages go to statsd
        type => "metlog"
        pattern => [ "type", "timer"]
        add_tag => [ "output_statsd" ]
    }

    tagger {
        # all sentry messages go to uh... sentry
        type => "metlog"
        pattern => [ "type", "sentry"]
        add_tag => [ "output_sentry" ]
    }

    tagger {
        # all CEF messages
        type => "metlog"
        pattern => [ "type", "cef"]
        add_tag => [ "output_cef" ]
    }

}


output {
    # keep stdout on to watch everything

    metlog_file {
        # The plaintext logfile
        tags => ["output_text"]
        format => "preformatted_field"
        prefix_timestamps => true
        formatted_field => "payload"
        path => "/tmp/var/log/metlog/metlog_classic.log"
    }

    metlog_file {
        # HDFS log file
        format => "json"
        formatted_field => "@fields"
        tags => ["output_hdfs"]
        path => "/tmp/var/log/metlog/metlog_hdfs.log"
    }

    metlog_statsd {
        # Timer messages get routed to statsd
        tags => ["output_statsd"]
        host => '127.0.0.1'
        port => 8125
    }

    metlog_sentry {
        # Timer messages get routed to statsd
        dsn => "http://168184e027dc4867a6409175d40fbe30:784d1607a40b4c9cb7390900c983394c@localhost:9000/1"
        tags => [ "output_sentry" ]
    }

    metlog_file {
        # CEF log file
        tags => ["output_cef"]
        format => "preformatted_field"
        formatted_field => "fields/logtext"
        path => "/tmp/var/log/metlog/metlog_cef.log"
    }


}
